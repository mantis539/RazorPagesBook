ADR 0003: Стиль API та модель обробки помилок
Дата: 25 грудня 2025 року

Статус: Прийнято

Контекст
Для забезпечення сумісності між серверною частиною та будь-якими клієнтами (веб-інтерфейс, мобільні додатки або сторонні сервіси) необхідно встановити єдиний стандарт взаємодії. Це включає формат URL, використання HTTP-методів та структуру відповідей у разі виникнення помилок.

Рішення
Ми впроваджуємо наступні стандарти:

1. Стиль API: RESTful
API проєкту базується на ресурсному підході (REST):

Ресурси іменуються іменниками у множині: /api/books, /api/reviews.

HTTP Методи визначають дію:

GET — читання даних.

POST — створення нового ресурсу.

PUT — повне оновлення існуючого ресурсу.

PATCH — часткове оновлення.

DELETE — видалення.

2. Модель помилок
Всі помилки в системі повинні повертати стандартизований JSON-об'єкт. Це дозволяє клієнту уніфіковано обробляти виняткові ситуації.

Структура помилки:

JSON

{
  "traceId": "унікальний-ідентифікатор-запиту",
  "message": "Загальне повідомлення про проблему",
  "errors": {
    "FieldName": ["Опис конкретної помилки валідації"]
  }
}
3. Політика HTTP-статусів
Ми суворо дотримуємося стандартних кодів стану:

200 OK — успішне читання або оновлення.

201 Created — успішне створення (повертається після POST).

204 No Content — успішна дія без потреби повертати тіло (наприклад, DELETE).

400 Bad Request — помилка валідації вхідних даних.

401 Unauthorized — користувач не пройшов автентифікацію.

403 Forbidden — у користувача недостатньо прав (наприклад, не Admin).

404 Not Found — ресурс за вказаним ID не існує.

500 Internal Server Error — непередбачена технічна помилка на сервері.

4. Відповідність OpenAPI (Contract First)
Файл openapi.yaml є "джерелом істини".

Будь-які зміни в методах або структурах даних спочатку фіксуються в специфікації, а потім реалізуються в коді.

Код сервісів та контролерів повинен гарантувати, що JSON-відповіді збігаються зі схемами, описаними в OpenAPI.

Обґрунтування
REST є галузевим стандартом, що спрощує інтеграцію.

Уніфікована модель помилок дозволяє фронтенду автоматично виводити повідомлення про помилки під потрібними полями форм.

TraceId критично важливий для логування: у разі скарги користувача розробник може швидко знайти помилку в логах за цим ID.

Наслідки
Позитивні: Зменшення "сюрпризів" при інтеграції, легка діагностика проблем у продакшні.

Ризики: Вимагає від розробника ретельної обробки кожного винятку (Exception Handling) у шарі Service або API, щоб не допустити витоку сирих системних помилок клієнту.
